<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <title>src/ui/yui/src/buttons/button-a.js - AlloyEditor</title>

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.ico">

    <!-- CSS -->
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">

    <!-- AlloyUI -->
    <link rel="stylesheet" href="http://cdn.alloyui.com/2.0.x/aui-css/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://cdn.alloyui.com/2.0.x/aui-css/css/bootstrap-responsive.min.css">
    <script src="http://cdn.alloyui.com/2.0.x/aui/aui-min.js"></script>

</head>
<body class="yui3-skin-sam">

    <div class="navbar">
        <div class="navbar-inner">
            <h1 class="brand">
                <a href="/">
                    <img alt="AlloyEditor" src="../assets/img/logo-small.png" title="AlloyEditor">
                </a>
            </h1>
            <div class="nav">
                <li class="divider-vertical"></li>
                <li>
                    <p class="navbar-text">
                        API Docs for Version: <b>0.2.1</b>
                    </p>
                </li>
            </div>
        </div>
    </div>

    <div id="bd" class="container">
        <div class="row">
            <div class="span3">
                <div id="docs-sidebar" class="sidebar apidocs">
                    <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview">
        <ul class="nav nav-tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes tab-pane">
            
                <li><a href="../classes/AlloyEditor.html">AlloyEditor</a></li>
            
                <li><a href="../classes/ButtonA.html">ButtonA</a></li>
            
                <li><a href="../classes/ButtonBase.html">ButtonBase</a></li>
            
                <li><a href="../classes/ButtonEm.html">ButtonEm</a></li>
            
                <li><a href="../classes/ButtonH1.html">ButtonH1</a></li>
            
                <li><a href="../classes/ButtonH2.html">ButtonH2</a></li>
            
                <li><a href="../classes/ButtonImage.html">ButtonImage</a></li>
            
                <li><a href="../classes/ButtonLeft.html">ButtonLeft</a></li>
            
                <li><a href="../classes/ButtonRight.html">ButtonRight</a></li>
            
                <li><a href="../classes/ButtonStrong.html">ButtonStrong</a></li>
            
                <li><a href="../classes/ButtonTwitter.html">ButtonTwitter</a></li>
            
                <li><a href="../classes/ButtonU.html">ButtonU</a></li>
            
                <li><a href="../classes/CKEDITOR.Link.html">CKEDITOR.Link</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.dropimages.html">CKEDITOR.plugins.dropimages</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.linktooltip.html">CKEDITOR.plugins.linktooltip</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.placeholder.html">CKEDITOR.plugins.placeholder</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.selectionregion.html">CKEDITOR.plugins.selectionregion</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.uicore.html">CKEDITOR.plugins.uicore</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.uiloader.html">CKEDITOR.plugins.uiloader</a></li>
            
                <li><a href="../classes/CKEDITOR.tools.html">CKEDITOR.tools</a></li>
            
                <li><a href="../classes/LinkTooltip.html">LinkTooltip</a></li>
            
                <li><a href="../classes/ToolbarAdd.html">ToolbarAdd</a></li>
            
                <li><a href="../classes/ToolbarAddItems.html">ToolbarAddItems</a></li>
            
                <li><a href="../classes/ToolbarBase.html">ToolbarBase</a></li>
            
                <li><a href="../classes/ToolbarImage.html">ToolbarImage</a></li>
            
                <li><a href="../classes/ToolbarStyles.html">ToolbarStyles</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules tab-pane">
            
            </ul>
        </div>
    </div>
</div>

                </div>
            </div>
            <div class="span9">
                    <div id="api-options" class="form-inline pull-right">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


                <div class="apidocs">
                    <div id="docs-main">
                        <div class="content">
                            <div class="page-header">
  <h1><small>File</small> <code>src/ui/yui/src/buttons/button-a.js</code></h1>
</div>

<div class="file">
    <pre class="code prettyprint linenums">
YUI.add(&#x27;button-a&#x27;, function(Y) {
    &#x27;use strict&#x27;;

    var Lang = Y.Lang,
        YNode = Y.Node,

        /**
         * The ButtonA class provides functionality for creating a link button.
         *
         * @class ButtonA
         */
        A = Y.Base.create(&#x27;a&#x27;, Y.Plugin.Base, [Y.ButtonBase], {
            /**
             * Initializer lifecycle implementation for the ButtonA class.
             *
             * @method initializer
             * @protected
             * @param  config {Object} Configuration object literal for the editor
             */
            initializer: function() {
                this._ckLink = new CKEDITOR.Link(this.get(&#x27;host&#x27;).get(&#x27;editor&#x27;));
            },

            /**
             * Renders the button which handles the link creation on the current selection and
             * the UI, which provides input element where the user will be able to specify the
             * href of the link.
             *
             * @method renderUI
             * @protected
             */
            renderUI: function() {
                this._renderButtonUI();

                this._renderLinkUI();
            },

            /**
             * Binds event subscriptions from the UI and the source (if assigned).
             * Registers a few events, like handling key press, or mouse events on
             * the button for clearing the link.
             *
             * @method bindUI
             * @protected
             */
            bindUI: function() {
                this.onHostEvent(&#x27;visibleChange&#x27;, this._onVisibleChange, this);

                this._linkInput.on(&#x27;keypress&#x27;, this._onKeyPress, this);
                this._linkInput.on(&#x27;valuechange&#x27;, this._onValueChange, this);

                this._showText.on(&#x27;click&#x27;, this._switchToTextMode, this);

                this._closeLink.on(&#x27;click&#x27;, this._onCloseLinkClick, this);
                this._clearInput.on(&#x27;click&#x27;, this._onClearInputClick, this);
            },

            /**
             * Overwrites the default implementation from {{#crossLink &quot;ButtonBase/updateUI:method&quot;}}{{/crossLink}}.
             * The button updates its &quot;pressed&quot; attribute and changes the UI accordingly to the presence or lack of
             * link style of the selection.
             *
             * @method updateUI
             */
            updateUI: function() {
                var editor,
                    elementPath,
                    iconLinkNode,
                    result;

                editor = this.get(&#x27;host&#x27;).get(&#x27;editor&#x27;);

                elementPath = editor.elementPath();

                if (this._style) {
                    result = this._style.checkActive(elementPath, editor);

                    this._button.set(&#x27;pressed&#x27;, !!result);
                }

                iconLinkNode = this._button.get(&#x27;boundingBox&#x27;).one(&#x27;i&#x27;);

                if (this._button.get(&#x27;pressed&#x27;)) {
                    iconLinkNode.replaceClass(&#x27;alloy-editor-icon-link&#x27;, &#x27;alloy-editor-icon-unlink&#x27;);
                } else {
                    iconLinkNode.replaceClass(&#x27;alloy-editor-icon-unlink&#x27;, &#x27;alloy-editor-icon-link&#x27;);
                }
            },

            /**
             * Changes position of the Toolbar, and adjusts it according to the selection,
             * since the width of the UI for adding/edtiting of link href  might be shorter
             * or larger than the default Toolbar UI.
             *
             * @method _adjustHostPosition
             * @protected
             * @param {Number} oldHostWidth The previous width of the host (Toolbar).
             */
            _adjustHostPosition: function(oldHostWidth) {
                var curHostWidth,
                    curXY,
                    diff,
                    host,
                    x;

                host = this.get(&#x27;host&#x27;);

                if (host.get(&#x27;visible&#x27;)) {
                    curHostWidth = host.get(&#x27;boundingBox&#x27;).get(&#x27;offsetWidth&#x27;);

                    diff = Math.abs((oldHostWidth - curHostWidth) / 2);

                    curXY = host.get(&#x27;xy&#x27;);

                    if (curHostWidth &lt; oldHostWidth) {
                        x = curXY[0] + diff;
                    } else {
                        x = curXY[0] - diff;
                    }

                    host.set(&#x27;xy&#x27;, [x, curXY[1]]);
                }
            },

            /**
             * Attaches a visibleChange listener on the Toolbar so the UI will commit or discard the link
             * if the button hides.
             *
             * @method _attachHideHandler
             * @protected
             */
            _attachHideHandler: function() {
                this._hideHandle = this.onceHostEvent(&#x27;visibleChange&#x27;, function(event) {
                    if (!event.newVal) {
                        this._handleLink();
                    }
                }, this);
            },

            /**
             * Attaches a visibleChange listener so the UI will commit or discard the link
             * when the button hides.
             *
             * @method _onClearInputClick
             * @protected
             */
            _onClearInputClick: function() {
                this._linkInput.set(&#x27;value&#x27;, &#x27;&#x27;);

                this._linkInput.focus();

                this._clearInput.hide();
                this._closeLink.disable();
            },

            /**
             * Hides the Toolbar on clicking the close link button.
             *
             * @method _onCloseLinkClick
             * @protected
             */
            _onCloseLinkClick: function() {
                this.get(&#x27;host&#x27;).hide();
            },

            /**
             * Handles the click event from the user. If button status is &quot;pressed&quot;, activates the UI for
             * creating the link. Otherwise, removes the link from the current selection.
             * On activating the UI for link creation, a default link with href= &quot;/&quot; will be created and it
             * will be kept in button instance as _defaultLink property. This link will also have an attribute,
             * called &quot;data-cke-default-link&quot;, so these links will be easily distinguished from the others.
             * An implementation of Link Tooltip for example may ignore these links.
             *
             * @method _onClick
             * @protected
             * @param {EventFacade} event Event that triggered when user clicked on the button.
             */
            _onClick: function(event) {
                var instance = this,
                    btnInst,
                    editor,
                    oldHostWidth,
                    linkInput,
                    selection;

                btnInst = event.target;

                editor = instance.get(&#x27;host&#x27;).get(&#x27;editor&#x27;);

                if (btnInst.get(&#x27;pressed&#x27;)) {
                    selection = editor.getSelection();

                    oldHostWidth = this.get(&#x27;host&#x27;).get(&#x27;boundingBox&#x27;).get(&#x27;offsetWidth&#x27;);

                    instance._buttonsContainer.addClass(&#x27;hide&#x27;);
                    instance._linkContainer.removeClass(&#x27;hide&#x27;);

                    this._adjustHostPosition(oldHostWidth);

                    linkInput = instance._linkInput;

                    linkInput.focus();

                    this._ckLink.create(&#x27;/&#x27;, {
                        &#x27;data-cke-default-link&#x27;: true
                    });

                    this._defaultLink = instance._link = this._ckLink.getFromSelection();

                    this._attachHideHandler();
                } else {
                    this._ckLink.remove();
                }
            },

            /**
             * Updates the default link with the real href, if any, or removes the
             * default link from the current selection.
             * See {{#crossLink &quot;ButtonA/_onClick:method&quot;}}{{/crossLink}} for more information
             * about the default link.
             *
             * @method _handleLink
             * @protected
             */
            _handleLink: function() {
                var editor,
                    href;

                href = this._linkInput.get(&#x27;value&#x27;);

                editor = this.get(&#x27;host&#x27;).get(&#x27;editor&#x27;);

                if (href) {
                    this._ckLink.update(href, this._link);

                    this._link.removeAttribute(&#x27;data-cke-default-link&#x27;);
                } else {
                    this._ckLink.remove(this._link);
                }

                this._linkInput.set(&#x27;value&#x27;, &#x27;&#x27;);

                this._link = null;
            },

            /**
             * Checks if user presses Enter key and hides the Toolbar, if so.
             *
             * @method _onKeyPress
             * @protected
             * @param {EventFacade} event Event that triggered when user pressed a key.
             */
            _onKeyPress: function(event) {
                if (event.charCode === 13) {
                    this.get(&#x27;host&#x27;).hide();
                }
            },

            /**
             * Shows or hides the close link button if link input contains some value.
             *
             * @method _onValueChange
             * @protected
             * @param {EventFacade} event An Event Facade object with the new and old value
             * of the input container.
             */
            _onValueChange: function(event) {
                if (event.newVal) {
                    this._clearInput.show();

                    this._closeLink.enable();
                } else {
                    this._clearInput.hide();

                    this._closeLink.disable();
                }
            },

            /**
             * On button hide, restore the default UI for creating link.
             * On button show, checks if the current selection has link style or not.
             * If it has, activates the UI for editing link, otherwise, activates the UI
             * for creating a link.
             *
             * @method _onValueChange
             * @protected
             * @param {EventFacade} event An Event Facade object with the new and old value
             * of visible property.
             */
            _onVisibleChange: function(event) {
                var editor,
                    link;

                if (!event.newVal) {
                    this._linkContainer.addClass(&#x27;hide&#x27;);
                    this.get(&#x27;host&#x27;).get(&#x27;buttonsContainer&#x27;).removeClass(&#x27;hide&#x27;);

                    this._clearInput.hide();
                    this._closeLink.disable();

                    this._defaultLink = null;
                } else {
                    // showing, check if we are over link already
                    // if we are, open the host in link mode
                    editor = this.get(&#x27;host&#x27;).get(&#x27;editor&#x27;);

                    link = this._ckLink.getFromSelection();

                    if (link) {
                        this._switchToLinkMode(link);
                    } else {
                        this._switchToTextMode();
                    }
                }
            },

            /**
             * Removes the attached visibleChange handler on the Toolbar which
             * handles the commit or discard process of the link.
             * See {{#crossLink &quot;ButtonA/_attachHideHandler:method&quot;}}{{/crossLink}} for more information.
             *
             * @method _removeHideHandler
             * @protected
             */
            _removeHideHandler: function() {
                if (this._hideHandle) {
                    this._hideHandle.detach();

                    this._hideHandle = null;
                }
            },

            /**
             * Creates the UI for adding a link.
             *
             * @method _renderLinkUI
             * @protected
             */
            _renderLinkUI: function() {
                var contentBox,
                    linkContainer;

                linkContainer = YNode.create(
                    Lang.sub(
                        this.TPL_LINK_CONTAINER, {
                            placeholder: this.get(&#x27;strings&#x27;).placeholder
                        }
                    )
                );

                contentBox = this.get(&#x27;host&#x27;).get(&#x27;contentBox&#x27;);

                contentBox.appendChild(linkContainer);

                this._buttonsContainer = this.get(&#x27;host&#x27;).get(&#x27;buttonsContainer&#x27;);

                this._linkContainer = linkContainer;

                this._linkInput = linkContainer.one(&#x27;input&#x27;);

                this._clearInput = linkContainer.one(&#x27;.input-clear i&#x27;);

                this._clearInput.hide();

                this._closeLink = new Y.Button({
                    disabled: true,
                    render: linkContainer.one(&#x27;.input-close-container&#x27;),
                    srcNode: linkContainer.one(&#x27;.close-link&#x27;)
                });

                this._showText = new Y.Button({
                    render: linkContainer.one(&#x27;.show-buttons-container&#x27;),
                    srcNode: linkContainer.one(&#x27;.switch-to-edit&#x27;)
                });
            },

            /**
             * Changes the UI of the Toolbar so the user will be able to change the styles
             * of the selection instead to create a link.
             *
             * @method _switchToTextMode
             * @protected
             */
            _switchToTextMode: function() {
                var bookmarks,
                    editor,
                    linkText,
                    oldHostWidth,
                    selection;

                this._removeHideHandler();

                if (this._defaultLink) {
                    // We were in text mode and default link has been created.
                    // If there is link text, we have to update the link with the new value.
                    // Otherwise, we have to remove the link and restore the selection.
                    linkText = this._linkInput.get(&#x27;value&#x27;);

                    if (!linkText) {
                        editor = this.get(&#x27;host&#x27;).get(&#x27;editor&#x27;);

                        selection = editor.getSelection();

                        bookmarks = selection.createBookmarks();

                        this._handleLink();

                        selection.selectBookmarks(bookmarks);
                    } else {
                        this._handleLink();
                    }

                    this._defaultLink = null;

                    this.fire(&#x27;actionPerformed&#x27;);
                }

                oldHostWidth = this.get(&#x27;host&#x27;).get(&#x27;boundingBox&#x27;).get(&#x27;offsetWidth&#x27;);

                this._linkContainer.addClass(&#x27;hide&#x27;);
                this._buttonsContainer.removeClass(&#x27;hide&#x27;);

                this._adjustHostPosition(oldHostWidth);
            },

            /**
             * Changes the UI of the Toolbar so the user will be able to to create a link to
             * change the styles of the selection.
             *
             * @method _switchToLinkMode
             * @protected
             * @param {CKEDITOR.dom.element} link The currently selected link from editor selection.
             */
            _switchToLinkMode: function(link) {
                var editor,
                    linkInput;

                editor = this.get(&#x27;host&#x27;).get(&#x27;editor&#x27;);

                link = link || this._ckLink.getFromSelection();

                this._clearInput.show();
                this._closeLink.disable();

                this._buttonsContainer.addClass(&#x27;hide&#x27;);
                this._linkContainer.removeClass(&#x27;hide&#x27;);

                linkInput = this._linkInput;

                linkInput.set(&#x27;value&#x27;, link.$.href);

                setTimeout(
                    function() {
                        linkInput.select();
                        linkInput.focus();
                    }, 0);

                this._link = link;

                this._attachHideHandler();
            },

            TPL_CONTENT: &#x27;&lt;i class=&quot;alloy-editor-icon-link&quot;&gt;&lt;/i&gt;&#x27;,

            TPL_LINK_CONTAINER: &#x27;&lt;div class=&quot;link-wrapper hide&quot;&gt;&#x27; +
                &#x27;&lt;div class=&quot;pull-left btn-group show-buttons-container&quot;&gt;&#x27; +
                &#x27;&lt;button class=&quot;alloy-editor-button btn btn-default switch-to-edit&quot;&gt;&lt;i class=&quot;alloy-editor-icon-font&quot;&gt;&lt;/i&gt;&lt;/button&gt;&#x27; +
                &#x27;&lt;/div&gt;&#x27; +
                &#x27;&lt;div class=&quot;pull-left btn-group input-wrapper&quot;&gt;&#x27; +
                &#x27;&lt;span class=&quot;input-container&quot;&gt;&#x27; +
                &#x27;&lt;input class=&quot;input-large&quot; type=&quot;text&quot; placeholder=&quot;{placeholder}&quot;&gt;&lt;/input&gt;&#x27; +
                &#x27;&lt;span class=&quot;input-clear&quot;&gt;&#x27; +
                &#x27;&lt;i class=&quot;alloy-editor-icon-remove-small&quot;&gt;&lt;/i&gt;&#x27; +
                &#x27;&lt;/span&gt;&#x27; +
                &#x27;&lt;/span&gt;&#x27; +
                &#x27;&lt;/div&gt;&#x27; +
                &#x27;&lt;div class=&quot;pull-right btn-group input-close-container&quot;&gt;&#x27; +
                &#x27;&lt;button class=&quot;alloy-editor-button btn btn-default close-link&quot;&gt;&lt;i class=&quot;alloy-editor-icon-ok&quot;&gt;&lt;/i&gt;&lt;/button&gt;&#x27; +
                &#x27;&lt;/div&gt;&#x27; +
                &#x27;&lt;/div&gt;&#x27;
        }, {
            NAME: &#x27;a&#x27;,

            NS: &#x27;a&#x27;,

            ATTRS: {
                /**
                 * Specifies the element (style) which this button handles.
                 *
                 * @attribute element
                 * @default &#x27;a&#x27;
                 * @type String
                 */
                element: {
                    validator: Lang.isString,
                    value: &#x27;a&#x27;
                },

                /**
                 * Collection of strings used to label elements of the button&#x27;s UI.
                 * ButtonA provides one string property, to specify the value of link placeholder.
                 *
                 * @attribute strings
                 * @default {placeholder: &#x27;Type or paste link here&#x27;}
                 * @type String
                 */
                strings: {
                    value: {
                        placeholder: &#x27;Type or paste link here&#x27;
                    }
                }
            }
        });

    Y.ButtonA = A;

}, &#x27;&#x27;, {
    requires: [&#x27;button-base&#x27;, &#x27;event-valuechange&#x27;]
});
    </pre>
</div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../assets/vendor/prettify/prettify-min.js"></script>
    <script>prettyPrint();</script>
    <script src="../assets/js/yui-prettify.js"></script>
    <script src="../assets/../api.js"></script>
    <script src="../assets/js/api-filter.js"></script>
    <script src="../assets/js/api-list.js"></script>
    <script src="../assets/js/api-search.js"></script>
    <script src="../assets/js/apidocs.js"></script>

</body>
</html>